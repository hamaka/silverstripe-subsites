--- xx-xx-xx			<file path> -	<Customization explanation> ----------------------------------------------

--- 24-02-2014		LeftAndMainSubsites.php

	public function Subsites() {
		// figure out what permission the controller needs
		// Subsite::accessible_sites() expects something, so if there's no permission
		// then fallback to using CMS_ACCESS_LeftAndMain.
		$permission = 'CMS_ACCESS_' . $this->owner->class;
		$available = Permission::get_codes(false);
		if(!isset($available[$permission])) {
			$permission = $this->owner->stat('required_permission_codes');
			if(!$permission) {
				$permission = 'CMS_ACCESS_LeftAndMain';
			}
		}

		return Subsite::accessible_sites($permission, false); // hamaka hmk custom - de false aan het einde zorg voor uitsluiten mainsite
	}

public function ListSubsites(){
		$list = $this->Subsites();
		$currentSubsiteID = Subsite::currentSubsiteID();

		if($list == null || $list->Count() == 1 && $list->First()->DefaultSite == true){
			return false;
		}

		Requirements::javascript('subsites/javascript/LeftAndMain_Subsites.js');

		$output = new ArrayList();

		foreach($list as $subsite) {
			$CurrentState = $subsite->ID == $currentSubsiteID ? 'selected' : '';

			$output->push(new ArrayData(array(
				'CurrentState' => $CurrentState,
				'ID' => $subsite->ID,
				'Title' => Convert::raw2xml($subsite->Title),
				'AbsoluteBaseURL' => $subsite->absoluteBaseURL() // hmk hamaka
			)));
		}

//echo(print_r($output,true)); exit;
		return $output;
	}

--- 24-02-2014		SubsiteList.ss
<div class="cms-subsites" data-pjax-fragment="SubsiteList">
	<div class="field dropdown">
		<select id="SubsitesSelect">
			<% loop $ListSubsites %>
				<option data-subsiteurl=\"{$AbsoluteBaseURL}admin/\" value="$ID" $CurrentState>$Title</option>
			<% end_loop %>
		</select>
	</div>
</div>


--- 24-02-2014		Subsite.php

	static function currentSubsiteID() {
		$id = NULL;
/* hmk hamaka custom
		if(isset($_GET['SubsiteID'])) {
			$id = (int)$_GET['SubsiteID'];
		}
		else if (Subsite::$use_session_subsiteid) {
			$id = Session::get('SubsiteID');
		}

		if($id === NULL) {
*/
			$id = self::getSubsiteIDForDomain();
//		}

		return (int)$id;
	}

--- 24-02-2014		LeftAndMain_Subsites.js

		$('#SubsitesSelect').entwine({
			onadd:function(){
				this.on('change', function(){
					var sel = document.getElementById('SubsitesSelect');
					var selected = sel.options[sel.selectedIndex];
					var subsiteurl = selected.getAttribute('data-subsiteurl');
					//window.location.search=$.query.set('SubsiteID', $(this).val());
					window.location.href=subsiteurl;
				});
			}
		});


--- 16-07-2014		code\extensions\ErrorPageSubsite.php
		fix voor ophalen van error-pagina path, voor het geval er geen DB-connectie is
		samenhang met friendlyError() verbetering in framework/dev/Debug.php

		// HAMAKA: check if front-end, so DB reliance can be avoided
		if (!is_subclass_of(Controller::curr(), "LeftAndMain")) {
			//get domain-name from URL, for no-database scenario
			if(isset($_SERVER['HTTP_HOST'])) {
				$subdomainPart = ltrim ($_SERVER['HTTP_HOST'], 'www.');
				return $static_filepath . "/error-{$statusCode}-{$subdomainPart}.html";
			} else {
				return false;
			}
		}
		
-- 09-12-2014		code\extenstions\SiteTreeSubsites.php
		fix voor URLsegment, lokaal werkte link door gebruik van mappen

			//HAMAKA: fix voor project mappen locale omgeving in URL opnemen
			if (Config::inst()->get('HmkMain', 'HostId')=='LOC') $baseUrl .= explode('/',Director::absoluteBaseURL())[3] . '/';

rband met een oneindige omleidingslus ('Too Many Redirects') bij het inloggen van een Subsitebeheerder.